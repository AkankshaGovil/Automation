#!/usr/bin/python
def __findTimeElement(fullString,element):
    """
    Parses the UpTime string returned from the iServer and returns the value of 
    the given unit of time(hour,minute,second).


    fullString -- Output returned by MSW when 'iserver <processname> uptime' command is executed
    
    element -- Unit of Time whose value is to be parsed and returned from fullString
    """
    value = '0'
    str_index = fullString.find(element)
    if (str_index != -1):
        value = fullString[str_index-2:str_index]
        if (value.isdigit() == False):
            value = fullString[str_index-1:str_index]
    else:
        value = '0'
    return value

def findiServerProcessUptime(msw,cmd):
    """
    Returns the iServer process uptime in seconds by executing the Command given
    and parsing the output.

    msw -- MSW SSH Session

    cmd -- Command to be executed on the MSW to find the uptime of different processes 
           (will be of the form 'iserver <processname> uptime')
    """  
    uptimestring = msw.filter(cmd)
    hour = __findTimeElement(uptimestring," hour")
    min = __findTimeElement(uptimestring," minute")
    sec = __findTimeElement(uptimestring," second")
    
    upTimeinSec = int(sec) + (int(min) * 60) + (int(hour) * 60 * 60) 
    return upTimeinSec

#*************************************************************************
if __name__ == '__main__':
    import session 
    testmsw = session.Session(command='ssh root@mymsw',prompt='#',args=[])
    
    uptime = findiServerProcessUptime(testmsw,'iserver gis uptime')
    print "iServer GIS Process UpTime in seconds = %s" %uptime

